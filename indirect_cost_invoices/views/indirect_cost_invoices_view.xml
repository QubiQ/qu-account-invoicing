<?xml version="1.0" encoding="utf-8"?>
<!-- Copyright 2018 <oscar.navarro@qubiq.es>
     License AGPL-3.0 or later (https://www.gnu.org/licenses/agpl). -->
<odoo>
    <record id="indirect_cost_invoices_view_form" model="ir.ui.view">
        <field name="name">indirect.cost.invoices.view.form</field>
        <field name="model">indirect.cost.invoices</field>
        <field name="arch" type="xml">
            <form string="Indirect Cost Invoice">
                <header>
                    <button string="Apply" name="action_validate_ic_product" states="draft" type="object" class="oe_highlight"/>
                    <button string="Cancel" name="action_invoice_cancel" states="done" type="object"/>
                    <button string="Reset to Draft" name="action_invoice_draft" states="cancel" type="object"/>
                    <field name="state" widget="statusbar" nolabel="1" statusbar_visible="draft,done"/>
                </header>
                <sheet string="Indirect Cost Invoice">
                    <h2>
                        <field name="name" readonly="1"/>
                    </h2>
                    <group>
                        <group>
                            <field name="invoice_id"
                                   attrs="{'readonly': [('state', '!=', 'draft')]}"
                                   options="{'no_create_edit': True, 'no_open': True}"
                            />
                            <field name="type_search" attrs="{'readonly': [('state', '!=', 'draft')]}"/>
                            <label for="date_start" string="Date period"/>
                            <div>
                                <field name="date_from" class="oe_inline" attrs="{'readonly': [('state', '!=', 'draft')]}"/>  to  <field name="date_to" class="oe_inline" attrs="{'readonly': [('state', '!=', 'draft')]}"/>
                            </div>
                        </group>
                        <group>
                            <field name="amount_untaxed" readonly="1"/>
                            <field name="unit_cost" readonly="1"/>
                            <field name="note"/>
                        </group>
                    </group>
                    <notebook>
                        <page string="Costumers">
                            <field name="partner_ids" options="{'no_create_edit': True, 'no_open': True}"/>
                        </page>
                        <page string="Products" attrs="{'invisible': [('type_search', '!=', 'product')]}">
                            <field name="product_ids" 
                                   options="{'no_create_edit': True, 'no_open': True}"
                            />
                        </page>
                        <page string="Categories" attrs="{'invisible': [('type_search', '!=', 'product_category')]}">
                            <field name="category_ids" 
                                   attrs="{'invisible': [('type_search', '!=', 'product_category')]}"
                                   options="{'no_create_edit': True, 'no_open': True}"
                            />
                        </page>
                        <page string="Invoice Lines" attrs="{'invisible': [('state', '=', 'draft')]}">
                            <field name="invoice_line_ids">
                                <tree create='false'>
                                    <field name="id" invisible="1"/>
                                    <field name="invoice_id"/>
                                    <field name="display_name"/>
                                    <field name="product_id"/>
                                    <field name="quantity"/>
                                    <field name="price_subtotal_signed"/>
                                    <field name="extra_cost"/>
                                </tree>
                                <form>
                                    <group>
                                        <group>
                                            <field name="invoice_id"/>
                                            <field name="display_name"/>
                                            <field name="product_id"/>
                                        </group>
                                        <group>
                                            <field name="quantity"/>
                                            <field name="price_subtotal_signed"/>
                                            <field name="extra_cost"/>
                                        </group>
                                    </group>
                                </form>
                            </field>
                        </page>
                        <page string="Internal Notes">
                            <field name="description"/>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

    <record id="view_indirect_cost_invoice_filter" model="ir.ui.view">
        <field name="name">view.indirect.cost.invoice.filter</field>
        <field name="model">indirect.cost.invoices</field>
        <field name="arch" type="xml">
            <search string="Search Indirect Cost Invoice">
                <field name="name" string="Invoice"/>
                <field name="note" string="Note"/>
                <filter string="Draft" domain="[('state','=','draft')]"/>
                <filter string="Done" domain="[('state','=','done')]"/>
                <filter string="Cancel" domain="[('state','=','cancel')]"/>
                <group expand="0" string="Group By">
                    <filter string="State" context="{'group_by': 'state'}"/>
                </group>
           </search>
        </field>
    </record>

    <record id="indirect_cost_invoices_tree" model="ir.ui.view">
        <field name="name">indirect.cost.invoices.tree</field>
        <field name="model">indirect.cost.invoices</field>
        <field name="arch" type="xml">
            <tree string="Indirect Cost Invoices">
                <field name="name" string="Invoice"/>
                <field name="date_from"/>
                <field name="date_to"/>
                <field name="note"/>
                <field name="state"/>
            </tree>
        </field>
    </record>
   
    <record id="action_indirect_cost_invoices_tree" model="ir.actions.act_window">
        <field name="name">Indirect Cost Invoices</field>
        <field name="res_model">indirect.cost.invoices</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree,form</field>
        <field name="view_id" ref="indirect_cost_invoices_tree"/>
        <field name="search_view_id" ref="view_indirect_cost_invoice_filter"/>
    </record>

    <menuitem name="Indirect Cost Invoices"
              action="action_indirect_cost_invoices_tree"
              id="menu_indirect_cost_invoices_tree"
              parent="account.menu_finance_entries_actions"
              sequence="1"
    />
</odoo>
